import React, { useState, useEffect, useRef } from 'react';
import { Heart, Camera, Music, Sparkles, ArrowRight, Image as ImageIcon, Star, Quote, Fingerprint, Scan, Key, Lock, XCircle, AlertTriangle, X, Maximize2 } from 'lucide-react';

/**
 * Modern, Elegant Valentine's Experience
 * Features:
 * - Heart Cursor Trail (Interactive)
 * - "Cuteness Scanner" Mini-Game
 * - "Unlock My Heart" Mini-Game
 * - "Impossible No" Button (Infinite Loop)
 * - Fake "Exit Intent" Blocker
 * - Smooth Transitions
 * - Elegant Photo Gallery with Lightbox
 */

// --- Components ---

// 1. Interactive Cursor Trail
const HeartCursor = () => {
  const [trail, setTrail] = useState([]);

  useEffect(() => {
    const handleMove = (e) => {
      const { clientX, clientY } = e.touches ? e.touches[0] : e;
      const id = Date.now();
      setTrail(prev => [...prev.slice(-20), { x: clientX, y: clientY, id }]);
      setTimeout(() => {
        setTrail(prev => prev.filter(p => p.id !== id));
      }, 800);
    };

    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', handleMove);
    return () => {
      window.removeEventListener('mousemove', handleMove);
      window.removeEventListener('touchmove', handleMove);
    };
  }, []);

  return (
    // Z-index increased to 100 to ensure visibility over modals if needed, 
    // though we will show system cursor for modals now too.
    <div className="fixed inset-0 pointer-events-none z-[100]">
      {trail.map((point, index) => (
        <div
          key={point.id}
          className="absolute w-4 h-4 text-rose-400 animate-fade-out"
          style={{
            left: point.x,
            top: point.y,
            opacity: (index + 1) / trail.length,
            transform: `translate(-50%, -50%) scale(${(index + 1) / trail.length})`,
            transition: 'all 0.1s ease-out'
          }}
        >
          <Heart fill="currentColor" className="w-full h-full" />
        </div>
      ))}
    </div>
  );
};

// 2. Background Floating Hearts
const FloatingHearts = () => {
  const [hearts, setHearts] = useState([]);

  useEffect(() => {
    const interval = setInterval(() => {
      const id = Math.random();
      const left = Math.random() * 100;
      const duration = 15 + Math.random() * 20; 
      const size = 10 + Math.random() * 20;
      
      setHearts(prev => [...prev, { id, left, duration, size }]);

      setTimeout(() => {
        setHearts(prev => prev.filter(h => h.id !== id));
      }, duration * 1000);
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  return (
    <div className="fixed inset-0 pointer-events-none overflow-hidden z-0">
      {hearts.map(h => (
        <div
          key={h.id}
          className="absolute bottom-[-50px] text-rose-200 opacity-40 animate-float"
          style={{
            left: `${h.left}%`,
            fontSize: `${h.size}px`,
            animationDuration: `${h.duration}s`
          }}
        >
          <Heart fill="currentColor" />
        </div>
      ))}
    </div>
  );
};

// --- Main Application ---

export default function App() {
  const [view, setView] = useState('intro'); // intro, compatibility, unlock, question, celebration, gallery, promises
  const [noBtnStyle, setNoBtnStyle] = useState({});
  const [noBtnText, setNoBtnText] = useState("No");
  const [noAttempts, setNoAttempts] = useState(0); 
  const [musicPlaying, setMusicPlaying] = useState(false);
  const [showExitModal, setShowExitModal] = useState(false);
  const [showFakeError, setShowFakeError] = useState(false);
  const [selectedPhoto, setSelectedPhoto] = useState(null); // For Lightbox
  const audioRef = useRef(null);

  // --- CONTENT CONFIGURATION ---

  // NOTE: Ensure these image files are in your project's public/assets folder
  const photos = [
    { id: 1, url: "img1.jpeg", caption: "Lost in the woods, found in you. üå≤" },
    { id: 2, url: "img3.jpeg", caption: "Every moment with you is magic. ‚ú®" },
    { id: 3, url: "img2.jpeg", caption: "On top of the world with you. üåç" },
    { id: 4, url: "img5.jpeg", caption: "Forever captivated by you. ü•∫" },
    { id: 5, url: "img4.jpeg", caption: "Smiles that light up my life. üíñ" }
  ];

  const promises = [
    "I promise to be with you, always.",
    "I promise to stay by your side, no matter what.",
    "I promise to let you hit me when I'm being annoying (until I'm good again).",
    "I promise you can kick me as much as you want (playfully, please!).",
    "I promise to give you reasons to never stop loving me, even when it's hard.",
    "I promise to keep falling for you, every single day.",
    "I promise to be your biggest supporter and your strength.",
    "I promise to always do my best to keep a smile on your face.",
    "I promise to always listen to your rants.",
    "I promise to love you even when you're hangry."
  ];

  const musicUrl = "https://cdn.pixabay.com/download/audio/2022/03/24/audio_17311d4e0b.mp3?filename=piano-moment-11634.mp3"; 

  // --- Logic ---

  useEffect(() => {
    if (audioRef.current) {
      audioRef.current.volume = 0.15; 
      if (musicPlaying) {
        audioRef.current.play().catch(e => console.log("Audio play failed (interaction needed):", e));
      } else {
        audioRef.current.pause();
      }
    }
  }, [musicPlaying]);

  // Handle Exit Intent (Mouse leaving window)
  useEffect(() => {
    const handleMouseLeave = (e) => {
      // Only show if we haven't reached the celebration yet and not already showing a modal
      if (e.clientY <= 0 && view !== 'celebration' && view !== 'gallery' && !selectedPhoto) {
        setShowExitModal(true);
      }
    };
    
    const handleBeforeUnload = (e) => {
      if (view !== 'celebration') {
        e.preventDefault();
        e.returnValue = ''; 
      }
    };

    document.addEventListener('mouseleave', handleMouseLeave);
    window.addEventListener('beforeunload', handleBeforeUnload);

    return () => {
      document.removeEventListener('mouseleave', handleMouseLeave);
      window.removeEventListener('beforeunload', handleBeforeUnload);
    };
  }, [view, selectedPhoto]);

  const moveNoButton = (e) => {
    if (e && e.type === 'touchstart') {
       // e.preventDefault(); 
    }

    const x = Math.random() * (window.innerWidth - 100);
    const y = Math.random() * (window.innerHeight - 100);
    
    const safeX = Math.min(Math.max(10, x), window.innerWidth - 110);
    const safeY = Math.min(Math.max(60, y), window.innerHeight - 100);

    setNoBtnStyle({
      position: 'fixed',
      left: `${safeX}px`,
      top: `${safeY}px`,
      transition: 'all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)', 
      zIndex: 50
    });
    
    const teasingTexts = ["Nice try!", "Too slow!", "Oops!", "Missed me!", "Can't catch me!", "Not today!", "Keep dreaming!", "Wrong button!"];
    setNoBtnText(teasingTexts[Math.floor(Math.random() * teasingTexts.length)]);
    setNoAttempts(prev => prev + 1);
  };

  const handleNoClick = () => {
    setShowFakeError(true);
    setTimeout(() => {
        setShowFakeError(false);
        moveNoButton(); 
    }, 2000);
  };

  // Logic to determine if we should show the system cursor
  // Show system cursor if: Exit Modal is open OR Lightbox is open
  const showSystemCursor = showExitModal || selectedPhoto !== null || showFakeError;

  // --- Views ---

  const ExitModal = () => (
    showExitModal && (
      <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fadeIn cursor-auto">
        <div className="bg-white p-8 rounded-3xl shadow-2xl max-w-sm text-center transform scale-100 animate-bounce-slow border-4 border-rose-100">
           <div className="mx-auto bg-rose-100 w-16 h-16 rounded-full flex items-center justify-center mb-4">
             <AlertTriangle className="text-rose-500 w-8 h-8" />
           </div>
           <h3 className="text-2xl font-serif text-gray-800 mb-2">Wait! Don't Go! ü•∫</h3>
           <p className="text-gray-600 mb-6">You haven't answered the most important question yet!</p>
           <button 
             onClick={() => setShowExitModal(false)}
             className="w-full py-3 bg-rose-500 text-white rounded-full font-bold hover:bg-rose-600 transition-all shadow-lg hover:shadow-rose-300/50"
           >
             Okay, I'll stay ‚ù§Ô∏è
           </button>
        </div>
      </div>
    )
  );

  const IntroView = () => (
    <div className="flex flex-col items-center justify-center min-h-screen text-center p-4 z-10 relative">
      <div className="bg-white/40 backdrop-blur-xl p-8 md:p-10 rounded-3xl border border-white/50 shadow-2xl max-w-lg w-full transform transition-all hover:shadow-rose-200/50">
        <div className="mb-6 flex justify-center">
          <div className="bg-pink-100 p-4 rounded-full animate-pulse">
            <Sparkles className="w-8 h-8 md:w-10 md:h-10 text-pink-600" />
          </div>
        </div>
        <h1 className="text-3xl md:text-5xl font-serif text-gray-800 mb-4 font-bold tracking-tight">
          Hey You.
        </h1>
        <p className="text-base md:text-lg text-gray-600 mb-8 font-light italic">
          I have something strictly confidential to ask you.
        </p>
        <button 
          onClick={() => {
            setView('compatibility'); 
            setMusicPlaying(true); 
          }}
          className="group w-full md:w-auto relative px-8 py-4 bg-gradient-to-r from-rose-500 to-pink-500 text-white rounded-full font-semibold text-lg shadow-lg hover:shadow-rose-300/50 transition-all active:scale-95"
        >
          <span className="relative z-10 flex items-center justify-center gap-2">
            Proceed <ArrowRight className="w-4 h-4 group-hover:translate-x-1 transition-transform" />
          </span>
        </button>
      </div>
    </div>
  );

  const CompatibilityView = () => {
    const [scanStatus, setScanStatus] = useState("idle"); 
    const [scanText, setScanText] = useState("Place Finger to Scan");
    
    const startScan = () => {
      setScanStatus("scanning");
      setScanText("Initializing...");
      
      const messages = [
        "Analyzing Aura...",
        "Checking Sass Levels...",
        "Calculating Cuteness...",
        "Measuring Heartbeat...",
        "Verifying Angel Status..."
      ];

      let i = 0;
      const interval = setInterval(() => {
        setScanText(messages[i]);
        i++;
        if (i >= messages.length) {
          clearInterval(interval);
          setScanStatus("result");
        }
      }, 800);
    };

    return (
      <div className="flex flex-col items-center justify-center min-h-screen text-center p-4 z-10 relative">
        <div className="bg-white/60 backdrop-blur-xl p-8 rounded-[2rem] border border-white/60 shadow-2xl max-w-md w-full">
          <h2 className="text-2xl font-serif text-rose-800 mb-6">Identity Check</h2>
          
          <div className="relative h-48 flex items-center justify-center mb-8">
            {scanStatus === "idle" && (
              <button onClick={startScan} className="flex flex-col items-center gap-4 text-rose-400 hover:text-rose-600 transition-colors animate-pulse">
                 <Fingerprint className="w-24 h-24" />
                 <span className="font-semibold text-lg">Tap to Scan</span>
              </button>
            )}

            {scanStatus === "scanning" && (
              <div className="flex flex-col items-center gap-4 relative">
                 <Scan className="w-24 h-24 text-rose-500 animate-spin-slow" />
                 <div className="absolute inset-0 bg-rose-500/20 animate-ping rounded-full"></div>
                 <span className="font-mono text-rose-600 font-bold">{scanText}</span>
              </div>
            )}

            {scanStatus === "result" && (
               <div className="flex flex-col items-center gap-2 animate-bounce-slow">
                 <div className="bg-green-100 p-4 rounded-full">
                   <Heart className="w-16 h-16 text-green-500 fill-green-500" />
                 </div>
                 <h3 className="text-2xl font-bold text-gray-800 mt-4">MATCH FOUND!</h3>
                 <p className="text-gray-600">You are the chosen one.</p>
               </div>
            )}
          </div>

          {scanStatus === "result" && (
            <button 
              onClick={() => setView('unlock')}
              className="w-full px-8 py-4 bg-rose-500 text-white rounded-full text-lg font-bold shadow-lg animate-fade-in-up"
            >
              Next Step
            </button>
          )}
        </div>
      </div>
    );
  };

  const UnlockGameView = () => {
    const [keys, setKeys] = useState([
      { id: 1, x: 20, y: 30, correct: false },
      { id: 2, x: 50, y: 80, correct: false },
      { id: 3, x: 80, y: 40, correct: true }, 
    ]);
    const [status, setStatus] = useState("locked"); 

    const handleKeyClick = (isCorrect) => {
      if (isCorrect) {
        setStatus("success");
        setTimeout(() => setView('question'), 1500);
      } else {
        setStatus("fail");
        setTimeout(() => setStatus("locked"), 1000);
      }
    };

    return (
      <div className="flex flex-col items-center justify-center min-h-screen text-center p-4 z-10 relative">
        <div className="bg-white/60 backdrop-blur-xl p-8 rounded-[2rem] border border-white/60 shadow-2xl max-w-md w-full">
          <h2 className="text-2xl font-serif text-rose-800 mb-2">Unlock My Heart</h2>
          <p className="text-gray-600 mb-8">Find the key that opens the lock.</p>
          
          <div className="relative h-64 bg-rose-50/50 rounded-xl mb-6 border border-rose-100 overflow-hidden">
             <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 transition-all">
                {status === "success" ? (
                   <Heart className="w-20 h-20 text-rose-500 animate-ping" fill="currentColor" />
                ) : (
                   <Lock className={`w-16 h-16 text-gray-400 ${status === 'fail' ? 'animate-shake text-red-400' : ''}`} />
                )}
             </div>

             {status !== "success" && keys.map((k) => (
                <button
                  key={k.id}
                  onClick={() => handleKeyClick(k.correct)}
                  className="absolute p-3 bg-white rounded-full shadow-md hover:scale-110 transition-transform hover:shadow-xl hover:bg-yellow-50"
                  style={{ top: `${k.y}%`, left: `${k.x}%` }}
                >
                  <Key className="w-6 h-6 text-yellow-500" />
                </button>
             ))}
          </div>
          
          <p className="text-xs text-gray-400 italic">Hint: Follow your intuition...</p>
        </div>
      </div>
    );
  };

  const QuestionView = () => (
    <div className="flex flex-col items-center justify-center min-h-screen text-center p-4 z-10 relative">
      
      {showFakeError && (
        <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm cursor-auto">
           <div className="bg-white p-6 rounded-2xl shadow-2xl animate-bounce-slow">
              <div className="text-red-500 mb-2 font-bold text-xl flex items-center justify-center gap-2">
                 <XCircle /> Error 404
              </div>
              <p className="text-gray-700">"No" is not available in this universe.</p>
           </div>
        </div>
      )}

      <div className="bg-white/60 backdrop-blur-xl p-8 md:p-12 rounded-[2rem] border border-white/60 shadow-2xl max-w-2xl w-full">
        <h1 className="text-4xl md:text-7xl font-serif text-transparent bg-clip-text bg-gradient-to-br from-rose-600 to-pink-500 mb-6 py-2 leading-tight">
          Be My Valentine?
        </h1>
        <p className="text-gray-600 mb-10 text-lg md:text-xl font-light">
          I promise to annoy you with love every single day.
        </p>
        
        <div className="flex flex-col md:flex-row gap-4 md:gap-6 justify-center items-center md:h-24">
          <button 
            onClick={() => setView('celebration')}
            className="w-full md:w-64 px-8 py-4 bg-rose-500 text-white rounded-full text-xl font-bold shadow-lg active:scale-95 transition-all duration-300 hover:bg-rose-600 hover:shadow-rose-400/50"
          >
            YES! ‚ù§Ô∏è
          </button>
          
          <button
            style={noBtnStyle}
            onMouseEnter={moveNoButton}
            onTouchStart={moveNoButton} 
            onClick={handleNoClick} 
            className="w-full md:w-auto min-w-[120px] px-8 py-4 bg-gray-200 text-gray-600 rounded-full text-xl font-bold transition-all select-none hover:bg-gray-300"
          >
            {noBtnText}
          </button>
        </div>
        
        {noAttempts > 2 && (
           <p className="text-xs text-rose-400/70 mt-4 animate-pulse">
             {noAttempts > 10 ? "Okay, now you're just playing with me..." : "Good luck catching that button üòâ"}
           </p>
        )}
      </div>
    </div>
  );

  const CelebrationView = () => (
    <div className="flex flex-col items-center pt-12 md:pt-20 min-h-screen p-4 z-10 relative pb-24">
      <div className="text-center mb-8 md:mb-12 animate-fade-in-up">
        <div className="inline-block bg-rose-100 p-6 rounded-full mb-6 animate-bounce-slow shadow-inner">
           <Heart className="w-16 h-16 text-rose-500 fill-rose-500" />
        </div>
        <h1 className="text-4xl md:text-6xl font-serif text-gray-800 mb-4">Finally! ‚ù§Ô∏è</h1>
        <p className="text-lg md:text-xl text-gray-600 font-light">
          You have no idea how happy this makes me.
        </p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 max-w-4xl w-full">
        <div 
          onClick={() => setView('gallery')}
          className="cursor-pointer group bg-white/60 backdrop-blur-lg p-6 md:p-8 rounded-3xl border border-white/60 hover:bg-white/80 transition-all shadow-lg hover:shadow-xl hover:-translate-y-1"
        >
          <div className="bg-rose-100 w-12 h-12 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
            <Camera className="text-rose-600 w-6 h-6" />
          </div>
          <h3 className="text-xl md:text-2xl font-serif text-gray-800 mb-2">Our Memories</h3>
          <p className="text-sm md:text-base text-gray-600">A little collection of us.</p>
        </div>

        <div 
          onClick={() => setView('promises')}
          className="cursor-pointer group bg-white/60 backdrop-blur-lg p-6 md:p-8 rounded-3xl border border-white/60 hover:bg-white/80 transition-all shadow-lg hover:shadow-xl hover:-translate-y-1"
        >
           <div className="bg-rose-100 w-12 h-12 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
            <Star className="text-rose-600 w-6 h-6" />
          </div>
          <h3 className="text-xl md:text-2xl font-serif text-gray-800 mb-2">My Vows</h3>
          <p className="text-sm md:text-base text-gray-600">Read my promises to you.</p>
        </div>
      </div>
    </div>
  );

  const PromisesView = () => (
    <div className="w-full max-w-4xl mx-auto pt-8 md:pt-10 px-4 md:px-6 min-h-screen z-10 relative pb-24">
      <div className="flex justify-between items-center mb-6 md:mb-8 sticky top-0 pt-2 bg-gradient-to-b from-transparent via-transparent to-transparent z-20">
        <button 
          onClick={() => setView('celebration')}
          className="flex items-center gap-2 text-gray-600 hover:text-rose-600 transition-colors bg-white/50 px-4 py-2 rounded-full backdrop-blur-sm shadow-sm hover:shadow-md"
        >
          <ArrowRight className="rotate-180 w-4 h-4" /> Back
        </button>
      </div>
      
      <div className="text-center mb-8">
        <h2 className="text-2xl md:text-3xl font-serif text-rose-800">My Promises</h2>
      </div>

      <div className="space-y-4">
        {promises.map((promise, index) => (
          <div 
            key={index} 
            className="bg-white/70 backdrop-blur-md p-5 md:p-6 rounded-2xl shadow-sm border border-white/60 flex items-start gap-4 transform transition-all hover:scale-[1.01] hover:bg-white/80"
            style={{ animationDelay: `${index * 100}ms` }}
          >
            <Quote className="text-rose-400 w-6 h-6 md:w-8 md:h-8 flex-shrink-0 mt-1 opacity-50" />
            <p className="text-lg md:text-xl text-gray-800 font-serif leading-relaxed">{promise}</p>
          </div>
        ))}
      </div>
    </div>
  );

  // Updated Gallery with Lightbox
  const GalleryView = () => (
    <div className="w-full max-w-6xl mx-auto pt-8 md:pt-10 px-4 md:px-6 min-h-screen z-10 relative pb-24">
      <div className="flex justify-between items-center mb-6 md:mb-8 sticky top-0 pt-2 z-20">
        <button 
          onClick={() => setView('celebration')}
          className="flex items-center gap-2 text-gray-600 hover:text-rose-600 transition-colors bg-white/50 px-4 py-2 rounded-full backdrop-blur-sm shadow-sm hover:shadow-md"
        >
          <ArrowRight className="rotate-180 w-4 h-4" /> Back
        </button>
      </div>

      <div className="text-center mb-8">
         <h2 className="text-3xl font-serif text-rose-800">Our Moments</h2>
      </div>

      {/* Masonry-style Grid */}
      <div className="columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6">
        {photos.map((photo) => (
          <div key={photo.id} className="break-inside-avoid relative group mb-6">
            <div 
              onClick={() => setSelectedPhoto(photo)}
              className="bg-white p-3 pb-12 rounded-lg shadow-xl transform transition-all hover:scale-[1.02] hover:rotate-1 cursor-pointer"
            >
              <div className="overflow-hidden rounded-md relative">
                <img 
                  src={photo.url} 
                  alt={photo.caption} 
                  className="w-full h-auto object-cover transition-transform duration-500 group-hover:scale-110"
                />
                <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100">
                    <Maximize2 className="text-white drop-shadow-md w-8 h-8" />
                </div>
              </div>
              <div className="absolute bottom-4 left-0 w-full text-center px-4">
                <p className="font-handwriting text-xl text-gray-700">{photo.caption}</p>
              </div>
            </div>
          </div>
        ))}
      </div>

      {/* Minimal Love Frame Lightbox */}
      {selectedPhoto && (
        <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-md p-4 animate-fadeIn cursor-auto">
          <div className="relative max-w-4xl w-full max-h-[90vh] bg-white p-4 md:p-6 rounded shadow-2xl animate-fade-in-up">
            {/* Minimal Frame Design */}
            <div className="absolute top-0 left-0 w-full h-full border-[12px] border-white pointer-events-none rounded box-border shadow-[inset_0_0_20px_rgba(0,0,0,0.1)]"></div>
            
            <button 
              onClick={() => setSelectedPhoto(null)}
              className="absolute -top-12 right-0 md:-right-12 text-white/80 hover:text-white transition-colors"
            >
              <X className="w-8 h-8" />
            </button>

            <div className="relative flex flex-col items-center">
               <div className="relative">
                 <img 
                   src={selectedPhoto.url} 
                   alt="Full Size" 
                   className="max-h-[70vh] w-auto rounded-sm object-contain"
                 />
                 {/* Decorative Hearts on corners */}
                 <div className="absolute -top-3 -left-3 text-rose-400 animate-bounce-slow"><Heart fill="currentColor" className="w-8 h-8" /></div>
                 <div className="absolute -bottom-3 -right-3 text-rose-400 animate-bounce-slow" style={{animationDelay: '0.5s'}}><Heart fill="currentColor" className="w-8 h-8" /></div>
               </div>
               
               <div className="mt-6 text-center">
                 <p className="font-handwriting text-3xl text-gray-800">{selectedPhoto.caption}</p>
               </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );

  return (
    <div className={`min-h-screen bg-gradient-to-br from-pink-100 via-red-50 to-rose-100 font-sans selection:bg-rose-200 overflow-x-hidden touch-manipulation ${showSystemCursor ? 'cursor-auto' : 'cursor-none'}`}>
      {/* Dynamic Background */}
      <FloatingHearts />
      {!showSystemCursor && <HeartCursor />} {/* Only show custom cursor when modal is closed */}
      <ExitModal />
      
      {/* Audio Element */}
      <audio ref={audioRef} src={musicUrl} loop />

      {/* Global CSS for Animations */}
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Dancing+Script:wght@600&family=Inter:wght@300;400;600&display=swap');
        
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-handwriting { font-family: 'Dancing Script', cursive; }
        
        /* Desktop cursor logic handled by React state now for better modal interaction */

        @keyframes float {
          0% { transform: translateY(0) rotate(0deg); opacity: 0; }
          100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
        .animate-float { animation: float linear infinite; }
        
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fadeIn 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
        
        .animate-spin-slow { animation: spin 3s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        @keyframes bounce-slow {
          0%, 100% { transform: translateY(-5px); }
          50% { transform: translateY(5px); }
        }
        .animate-bounce-slow { animation: bounce-slow 3s ease-in-out infinite; }
        
        @keyframes fadeOut {
          to { opacity: 0; transform: scale(0.5); }
        }
        .animate-fade-out { animation: fadeOut 0.8s forwards; }

        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.4s ease-in-out; }
      `}</style>

      {/* Main Content Render */}
      <main className="relative z-10 transition-all duration-500 ease-in-out">
        {view === 'intro' && <IntroView />}
        {view === 'compatibility' && <CompatibilityView />}
        {view === 'unlock' && <UnlockGameView />}
        {view === 'question' && <QuestionView />}
        {view === 'celebration' && <CelebrationView />}
        {view === 'gallery' && <GalleryView />}
        {view === 'promises' && <PromisesView />}
      </main>

      {/* Persistent Music Control */}
      <div className="fixed bottom-6 right-6 z-50">
        <button 
          onClick={() => setMusicPlaying(!musicPlaying)}
          className={`p-3 md:p-4 rounded-full shadow-lg transition-all transform hover:scale-105 ${musicPlaying ? 'bg-rose-500 text-white animate-spin-slow' : 'bg-white/80 text-gray-600 hover:bg-white'}`}
          title={musicPlaying ? "Pause Music" : "Play Music"}
        >
          {musicPlaying ? <Music className="w-5 h-5 md:w-6 md:h-6" /> : <Music className="w-5 h-5 md:w-6 md:h-6 opacity-50" />}
        </button>
      </div>
    </div>
  );
}
